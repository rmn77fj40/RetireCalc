<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Detailed Retirement Planning Calculator</title>
    <link rel="stylesheet" href="style.css"> </head>
<body>

    <div class="main-title">Detailed Retirement Planning Calculator</div>

    <div class="button-group help-button-container">
        <button onclick="toggleHelpSection()">Help / Documentation</button>
    </div>

    <div class="calculator-container">

        <div class="calculator-section">
            <h3>Personal Information</h3>
            <div class="input-group">
                <label for="robBirthDate">Your Birth Date:</label>
                <input type="date" id="robBirthDate" value="1964-10-04">
            </div>
            <div class="input-group">
                <label for="sonjaBirthDate">Partner's Birth Date:</label>
                <input type="date" id="sonjaBirthDate" value="1964-02-27">
            </div>
            <div class="input-group">
                <label for="initialSavings">Current Savings/Investments ($):</label>
                <input type="number" id="initialSavings" value="720000">
            </div>
            <div class="input-group">
                <label for="retirementAge">Your Desired Retirement Age:</label>
                <input type="number" id="retirementAge" value="65">
            </div>
            <div class="input-group">
                <label for="partnerRetirementAge">Partner's Desired Retirement Age:</label>
                <input type="number" id="partnerRetirementAge" value="62">
            </div>
            <div class="input-group">
                <label for="planToAge">Life Expectancy for Projection (max age):</label>
                <input type="number" id="planToAge" value="95">
            </div>
            <div class="input-group">
                <label for="overrideCurrentAge">Simulate Your Current Age (Optional):</label>
                <input type="number" id="overrideCurrentAge" placeholder="Leave blank for actual age">
            </div>
            <div class="input-group">
                <label for="overridePartnerCurrentAge">Simulate Partner's Current Age (Optional):</label>
                <input type="number" id="overridePartnerCurrentAge" placeholder="Leave blank for actual age">
            </div>
        </div>

        <div class="calculator-section">
            <h3>Growth & Inflation</h3>
            <div class="input-group">
                <label for="averageMarketReturn">Annual Pre-Retirement Growth Rate (%):</label>
                <input type="number" id="averageMarketReturn" value="7" step="0.1">
            </div>
            <div class="input-group">
                <label for="postRetirementGrowthRate">Annual Post-Retirement Growth Rate (%):</label>
                <input type="number" id="postRetirementGrowthRate" value="6" step="0.1">
            </div>
            <div class="input-group">
                <label for="annualInflationRate">Annual Inflation Rate (%):</label>
                <input type="number" id="annualInflationRate" value="2.5" step="0.1">
            </div>
             <div class="input-group">
                <label for="filingStatus">Tax Filing Status:</label>
                <select id="filingStatus">
                    <option value="marriedJointly">Married Filing Jointly</option>
                    <option value="single">Single</option>
                </select>
            </div>
            <div class="checkbox-group">
                <input type="checkbox" id="calculateInTodayDollars" checked>
                <label for="calculateInTodayDollars">Calculate in Today's Dollars (Adjust for inflation)</label>
            </div>
        </div>

        <div class="calculator-section">
            <h3>Income & Contributions</h3>
            <div class="input-group">
                <label for="monthlyInvestmentContribution">Monthly Investment Contribution ($):</label>
                <input type="number" id="monthlyInvestmentContribution" value="300">
            </div>
            <div class="input-group">
                <label for="robCurrentSalary">Your Current Annual Salary ($):</label>
                <input type="number" id="robCurrentSalary" value="50000">
            </div>
            <div class="input-group">
                <label for="salaryGrowthRate">Annual Salary Growth Rate (%):</label>
                <input type="number" id="salaryGrowthRate" value="1.0" step="0.1">
            </div>
            <div class="input-group">
                <label for="sonjaCurrentSalary">Partner's Current Annual Salary ($):</label>
                <input type="number" id="sonjaCurrentSalary" value="0">
            </div>
            <div class="input-group">
                <label for="robSocialSecurityMonthly">Your Monthly Social Security ($):</label>
                <input type="number" id="robSocialSecurityMonthly" value="2863">
            </div>
            <div class="input-group">
                <label for="robSocialSecurityStartAge">Your SS Start Age:</label>
                <input type="number" id="robSocialSecurityStartAge" value="65">
            </div>
            <div class="input-group">
                <label for="sonjaSocialSecurityMonthly">Partner's Monthly Social Security ($):</label>
                <input type="number" id="sonjaSocialSecurityMonthly" value="1707">
            </div>
            <div class="input-group">
                <label for="sonjaSocialSecurityStartAge">Partner's SS Start Age:</label>
                <input type="number" id="sonjaSocialSecurityStartAge" value="62">
            </div>
            <div class="input-group">
                <label for="otherMonthlyIncome">Other Monthly Income (e.g., pension, annuity) ($):</label>
                <input type="number" id="otherMonthlyIncome" value="1000">
            </div>
            <div class="input-group">
                <label for="peraAnnualIncreaseRate">Colorado PERA Annual Increase Rate (%):</label>
                <input type="number" id="peraAnnualIncreaseRate" value="1.0" step="0.1">
            </div>
            <div class="input-group">
                <label for="peraAIWaitMonths">Colorado PERA AI Waiting Period (Months after retirement):</label>
                <input type="number" id="peraAIWaitMonths" value="36">
            </div>
        </div>

        <div class="calculator-section">
            <h3>Retirement Expenses</h3>
            <div class="input-group">
                <label for="monthlyRetirementSpending">Base Living Expenses (Monthly, in today's dollars):</label>
                <input type="number" id="monthlyRetirementSpending" value="5000">
            </div>
            <div class="input-group">
                <label for="goGoMonthlySpending">Go-Go Monthly Spending (Additional) ($):</label>
                <input type="number" id="goGoMonthlySpending" value="3500">
            </div>
            <div class="input-group">
                <label for="goGoStartAge">Go-Go Start Age:</label>
                <input type="number" id="goGoStartAge" value="65">
            </div>
            <div class="input-group">
                <label for="goGoEndAge">Go-Go End Age:</label>
                <input type="number" id="goGoEndAge" value="83">
            </div>

            <div class="input-group">
                <label for="goSlowMonthlySpending">Go-Slow Monthly Spending (Additional) ($):</label>
                <input type="number" id="goSlowMonthlySpending" value="500">
            </div>
            <div class="input-group">
                <label for="goSlowStartAge">Go-Slow Start Age:</label>
                <input type="number" id="goSlowStartAge" value="84">
            </div>
            <div class="input-group">
                <label for="goSlowEndAge">Go-Slow End Age:</label>
                <input type="number" id="goSlowEndAge" value="87">
            </div>
        </div>

    </div>
    <div class="button-group">
        <button id="calculateBtn">Calculate Retirement</button>
        <button id="exportCsvBtn">Export to CSV</button>
    </div>

    <div class="calculator-container" style="justify-content: unset; max-width: 900px; padding: 0;">
        <div class="calculator-section summary-results">
            <h3>Summary Results</h3>
            <div class="summary-item"><strong>Your Age at End of Plan:</strong> <span id="summaryRobAge">--</span></div>
            <div class="summary-item"><strong>Partner's Age at End of Plan:</strong> <span id="summarySonjaAge">--</span></div>
            <div class="summary-item"><strong>Balance at Your Retirement Age:</strong> <span id="balanceAtRobRetirement">--</span></div>
            <div class="summary-item"><strong>Balance at End of Plan:</strong> <span id="balanceAtEndOfPlan">--</span></div>
            <div class="summary-item"><strong>First Shortfall Year:</strong> <span id="shortfallYear">--</span></div>
        </div>
    </div>


    <div id="helpSection" class="calculator-container help-section" style="display: none;">
        <div class="calculator-section" style="flex: 1 1 100%;">
            <h2>Retirement Planning Calculator: User Guide & Documentation</h2>

            <h3>Part 1: How to Use the Calculator (Instructions)</h3>
            <ol>
                <li><strong>Input Your Data:</strong>
                    <ul>
                        <li><strong>Personal Information:</strong> Enter birth dates, current savings, desired retirement ages, life expectancy, and optionally, simulate current ages.</li>
                        <li><strong>Growth & Inflation:</strong> Input pre/post-retirement growth rates, inflation rate, and choose whether to calculate in "Today's Dollars." You will also select your `Tax Filing Status` which impacts how federal income and Social Security taxes are calculated.</li>
                        <li><strong>Income & Contributions:</strong> Enter monthly investment contributions, current salaries (yours and partner's), salary growth rate, Social Security details (monthly amount & start age), other monthly income, and Colorado PERA details if applicable.</li>
                        <li><strong>Retirement Expenses:</strong> Define your base monthly living expenses and set up phased spending (Go-Go, Go-Slow) with their respective monthly amounts and age ranges.</li>
                    </ul>
                </li>
                <li><strong>Run the Calculation:</strong> Click the <strong>"Calculate Retirement"</strong> button.</li>
                <li><strong>Review Results:</strong>
                    <ul>
                        <li><strong>Summary Results:</strong> Provides high-level figures like ending balance and first shortfall year.</li>
                        <li><strong>Detailed Projection Table:</strong> Offers a year-by-year breakdown of your finances, including estimated taxes. Shortfall rows are highlighted.</li>
                    </ul>
                </li>
                <li><strong>Export Data (Optional):</strong> Click <strong>"Export to CSV"</strong> to download the detailed projection.</li>
            </ol>

            <h3>Part 2: How the Calculator Works (Summary of Logic)</h3>
            <p>The calculator performs a year-by-year simulation of your financial situation from your current age (or simulated age) until your specified maximum life expectancy. It dynamically adjusts income, expenses, contributions, and investment growth based on predefined ages and rates.</p>

            <h4>Core Calculation Flow (Annual Iteration):</h4>
            <p>For each year of the projection, the calculator performs the following steps:</p>
            <ol>
                <li><strong>Determine Ages and Year:</strong> Calculates your and your partner's ages for the current year.</li>
                <li><strong>Apply Pre/Post-Retirement Rates:</strong> Uses `Pre-Retirement Growth Rate` and includes salaries/contributions until your retirement age, then switches to `Post-Retirement Growth Rate` with no salaries/contributions.</li>
                <li><strong>Calculate Income Streams:</strong> Adds salaries (if working), Social Security (from start age, inflated), and other income like pensions (with PERA inflation/waiting period).</li>
                <li><strong>Calculate Expenses:</strong> Sums `Base Living Expenses` and `Go-Go`/`Go-Slow` additional spending (if within age ranges), all inflated.</li>
                <li><strong>Calculate Taxes:</strong> This is a key step where federal income tax and Social Security benefit taxation are estimated.
                    <ul>
                        <li><strong>Federal Income Tax:</strong> The calculator determines your federal income tax liability by applying the <strong>2024 IRS federal income tax brackets and standard deductions</strong>.
                            <br>Your taxable income is derived from various sources, including salaries, pensions, and the taxable portion of Social Security benefits.
                            <br>Before applying tax brackets, the calculator will subtract the appropriate 2024 standard deduction based on your chosen filing status:
                            <ul>
                                <li><strong>Single:</strong> $14,600</li>
                                <li><strong>Married Filing Jointly:</strong> $29,200</li>
                            </ul>
                            After applying the standard deduction, your remaining taxable income is subjected to the progressive tax rate system.
                            <ul>
                                <li><strong>For Single Filers:</strong> 10% up to $11,600; 12% on income between $11,601 and $47,150; 22% on income between $47,151 and $100,525; 24% on income between $100,526 and $191,950; 32% on income between $191,951 and $243,725; 35% on income between $243,726 and $609,350; 37% on income over $609,350.</li>
                                <li><strong>For Married Filing Jointly:</strong> 10% up to $23,200; 12% on income between $23,201 and $94,300; 22% on income between $94,301 and $201,050; 24% on income between $201,051 and $383,900; 32% on income between $383,901 and $487,450; 35% on income between $487,451 and $731,200; 37% on income over $731,200.</li>
                            </ul>
                        </li>
                        <li><strong>Social Security Benefit Taxation:</strong> The calculator employs the IRS's "combined income" rules to determine the taxable portion of your Social Security benefits. "Combined income" is generally defined as your Adjusted Gross Income (AGI) + any nontaxable interest + one-half of your Social Security benefits.
                            <br>Here are the 2024 thresholds:
                            <ul>
                                <li><strong>For Single Filers:</strong> If combined income is below $25,000, none taxable; between $25,000 and $34,000, up to 50% taxable; above $34,000, up to 85% taxable.</li>
                                <li><strong>For Married Filing Jointly:</strong> If combined income is below $32,000, none taxable; between $32,000 and $44,000, up to 50% taxable; above $44,000, up to 85% taxable.</li>
                            </ul>
                        </li>
                        <li><strong>Colorado State Income Tax:</strong> Colorado has a flat state income tax rate of <strong>4.25%</strong> (for 2024). This rate is applied to your total taxable ordinary income before federal deductions. Colorado also offers a retirement income deduction: up to $20,000 for individuals aged 55-64, and up to $24,000 for individuals aged 65 or older.</li>
                    </ul>
                </li>
                <li><strong>Investment Growth:</strong> Applies the determined annual growth rate to the beginning balance for the year.</li>
                <li><strong>Determine Withdrawals/Shortfall:</strong> If income (after taxes) doesn't cover expenses, funds are withdrawn from savings. If savings go negative, a `Shortfall` is recorded.</li>
                <li><strong>Inflation Adjustment (for "Today's Dollars" display):</strong> If "Calculate in Today's Dollars" is checked, all displayed values (except raw investment growth for clarity) are de-inflated to today's purchasing power.</li>
                <li><strong>Store and Iterate:</strong> The year's results are stored, and the ending balance becomes the starting balance for the next year.</li>
            </ol>

            <h4>Key Features and Assumptions:</h4>
            <ul>
                <li><strong>Year-by-Year Progression:</strong> Annual simulation, changes take effect at the start of the year the age is met.</li>
                <li><strong>Today's Dollars vs. Nominal Dollars:</strong> Crucial for interpreting results; "Today's Dollars" adjusts for purchasing power.</li>
                <li><strong>Tax Model:</strong>
                    <ul>
                        <li>Uses **2024 Federal Income Tax Brackets and Standard Deductions** for Single and Married Filing Jointly statuses.</li>
                        <li>Incorporates **Social Security benefit taxation rules**, where a portion of SS benefits may become taxable based on "combined income" thresholds.</li>
                        <li>Includes **Colorado State Income Tax** at a flat rate, factoring in the retirement income deduction.</li>
                        <li>**Capital gains taxes, and other specific deductions/credits are NOT included.** This calculator provides an estimation of income tax liability. Consult a tax professional for precise tax planning.</li>
                        </ul>
                </li>
                <li><strong>No Inter-year Compounding:</strong> Growth and flows are modeled annually.</li>
                <li><strong>PERA AI Logic:</strong> Specific logic for Colorado PERA pension increases after a waiting period.</li>
            </ul>
            <div style="text-align: center; margin-top: 20px;">
                <button onclick="toggleHelpSection()">Close Help</button>
            </div>
        </div>
    </div>

    <div class="calculator-container detailed-projection" style="justify-content: unset; padding: 0;">
        <div class="calculator-section" style="flex: 1 1 100%;">
            <h3>Detailed Projection</h3>
            <div class="table-responsive">
                <table id="resultsTable">
                    <thead>
                        <tr>
                            <th>Year</th>
                            <th>Your Age</th>
                            <th>Partner Age</th>
                            <th>Savings Start ($)</th>
                            <th>Contrib. ($)</th>
                            <th>Inv. Growth ($)</th>
                            <th>Social Security Income ($)</th>
                            <th>Pension Income ($)</th>
                            <th>Total Income ($)</th>
                            <th>Total Exp. ($)</th>
                            <th>Total Tax ($)</th>
                            <th>Withdrawals ($)</th>
                            <th>Savings End ($)</th>
                            <th>Shortfall ($)</th>
                        </tr>
                    </thead>
                    <tbody>
                        </tbody>
                </table>
            </div>
        </div>
    </div>

    <script src="script.js"></script>

</body>
</html>
